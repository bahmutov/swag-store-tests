name: ci
on: [push, workflow_dispatch]
jobs:
  e2e:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout ğŸ›ï¸
        # https://github.com/actions/checkout
        uses: actions/checkout@v4

      - name: Check out the app ğŸ›ï¸
        uses: actions/checkout@v4
        with:
          # todo: pass the correct reference
          # to check out the right branch / commit
          repository: bahmutov/swag-store
          path: swag-store
          token: ${{ secrets.SWAG_REPO_GH_TOKEN }}

      - name: Show the source files
        run: |
          ls -la
          ls -la swag-store

      # https://github.com/cypress-io/github-action
      - name: Install dependencies in this repo ğŸ“¦
        uses: cypress-io/github-action@v6
        with:
          runTests: false

      - name: Install app dependencies ğŸ“¦
        # https://github.com/bahmutov/npm-install
        uses: bahmutov/npm-install@v1
        with:
          working-directory: swag-store

      - name: Start the app
        run: npm start &
        working-directory: swag-store

      - name: Run E2E tests
        uses: cypress-io/github-action@v6
        with:
          install: false
          wait-on: 'http://localhost:3000'
